// Generated by CoffeeScript 1.3.3
(function() {
  var submitPagesForm;

  $('[data-mvp-act="submit"]').on('click', function(e) {
    return $($(this).attr('data-target')).submit();
  });

  $('#pages-form').validate({
    ignoreTitle: true,
    errorElement: 'small',
    errorClass: 'invalid',
    ignore: '[type="hidden"], .hide',
    errorPlacement: function(err, ele) {
      return err.insertAfter(ele);
    },
    submitHandler: function(form) {
      $(form).find('[type="submit"]').attr('disabled', true);
      submitPagesForm(form);
      return false;
    }
  });

  submitPagesForm = function(form) {
    var exists, url;
    exists = $(form).find('[name="_method"]').val() === 'PUT';
    url = (exists ? "/admin/pages/" + $("#page_id").val() + "/edit" : "/admin/pages/create");
    return $.post(url, $(form).serialize(), function(data) {
      $(form).find('[type="submit"]').removeAttr('disabled');
      if (data.result === 'success') {
        if (exists) {
          return $.growl({
            title: "Your page has been saved",
            message: ""
          });
        } else {
          return window.location.href = "/admin/pages?message=Your-page-has-been-saved";
        }
      } else {
        return $.growl({
          title: "Oops",
          message: "An error has occured"
        });
      }
    }, 'json');
  };

}).call(this);
